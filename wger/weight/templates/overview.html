{% extends "base.html" %}
{% load i18n staticfiles wger_extras %}

<!--
        Title
-->
{% block title %}{% trans "Weight overview" %}{% endblock %}

<!--
        Header data
-->
{% block header %}
<link rel="stylesheet" type="text/css" href="{% static 'bower_components/metrics-graphics/dist/metricsgraphics.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/metricsgraphics-custom.css' %}">
<script src="{% static 'bower_components/metrics-graphics/dist/metricsgraphics.min.js' %}"></script>


<script type="text/javascript">
var globals = {};
var modify_time_period_params = {
    animate_on_load: true,
    full_width: true,
    height: 300,
    show_secondary_x_label: true,
    xax_count: 10,
    target: '#weight_diagram',
    x_accessor: 'date',
    y_accessor: 'weight',
}

$(document).ready(function () {

    d3.json("/weight/api/get_weight_data/{{ owner_user.username }}", function(json) {

        data =  MG.convert.date(json, 'date');
        globals.data = data;

        // Plot the data
        modify_time_period_params.data = data;
        MG.data_graphic(modify_time_period_params);
    });

    $('.modify-time-period-controls button').click(function() {
        var past_n_days = $(this).data('time_period');
        var data = modify_time_period(globals.data, past_n_days);

        // change button state
        $(this).addClass('active').siblings().removeClass('active');

        modify_time_period_params.data = data;
        MG.data_graphic(modify_time_period_params);
    });
});


function modify_time_period(data, past_n_days) {
    if (past_n_days !== 'all' || past_n_days !== '') {
        return MG.clone(data).slice(past_n_days * -1);
    }

    return data;
}
</script>
{% endblock %}


<!--
        Main Content
-->
{% block content %}
{% if not min_date %}
<p>
    {% trans "There is no chart here because there are no weight entries." %}
    {% trans "Use link to add one." %}
</p>
{% endif %}

<div id="weight_diagram"></div>


<div class="btn-group modify-time-period-controls pull-right" role="group" aria-label="..." style="padding-bottom: 1em;">
    <button type="button" class="btn btn-default" data-time_period="90">{% trans "Last 3 months" %}</button>
    <button type="button" class="btn btn-default" data-time_period="365">{% trans "Last 12 months" %}</button>
    <button type="button" class="btn btn-default active" data-time_period="all">{% trans "No filter" %}</button>
</div>


{% if is_owner %}
{% if last_five_weight_entries_details %} 
<table class="table">
    <tr>  
        <th>{% trans 'Date' %}</th>
        <th>{% trans 'Weight' %}</th>
        <th>{% trans 'Change' context "Noun, not verb" %}</th>
        <th>{% trans 'Days' %}</th>
    </tr>
    {% for entry_detail in last_five_weight_entries_details %}
        <tr>
            <td>{{ entry_detail.0.date }}</td>
            <td>{{ entry_detail.0.weight }}</td>
            <!-- weight diff and day diff below -->
            <td>
                {% if entry_detail.1 > 0 %}
                    +
                {% endif %}
                {% if entry_detail.1 %}
                    {{ entry_detail.1 }}
                {% else %}
                    -/-
                {% endif %}
            </td>
            <td>
                {% if entry_detail.2 %} 
                    {{ entry_detail.2 }}
                {% else %}
                    -/-
                {% endif %}
            </td>
        </tr>
    {% endfor %}
</table>
{% endif %}
{% endif %}

{% endblock %}


<!--
        Side bar
-->
{% block sidebar %}
<p>
    <a href="{% url 'weight:add' %}" class="btn btn-success btn-sm wger-modal-dialog">
        {% trans "Add weight entry" %}
    </a>
</p>

{% if is_owner %}
<h4>{% trans "Options" %}</h4>
<p>
    <a href="{% url 'weight:export-csv' %}"
       target="_blank"
       {% auto_link_css flavour %}>
    <img src="{% static 'images/icons/save.svg' %}"
         width="32"
         height="32"
         alt="{% trans 'Export as CSV' %}"
         title="{% trans 'Export as CSV' %}">
        {% trans "Export as CSV" %}
    </a>
</p>

<p>
    <a href="{% url 'weight:import-csv' %}" {% auto_link_css flavour %}>
    <img src="{% static 'images/icons/csv-table.svg' %}"
         width="32"
         height="32"
         alt="{% trans 'Import from spreadsheet' %}"
         title="{% trans 'Import from spreadsheet' %}">
        {% trans "Import from spreadsheet" %}
    </a>
</p>
{% endif %}

{% endblock %}
