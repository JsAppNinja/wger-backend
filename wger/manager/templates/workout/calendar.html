{% extends "base.html" %}
{% load url from future %}
{% load i18n %}
{% load staticfiles %}
{% load wger_extras %}

{% block title %}{% trans "Workout log calendar" %}{% endblock %}

{% block header %}
<script>
$(document).ready(function() {
    $('.filled a').click(function(e){
        e.preventDefault();
        $('.calendar-log-data').hide();
        $('#' + $(this).data('log')).toggle();
    });
 });
</script>
{% endblock %}

{% block content %}
{{calendar|safe}}

{% for date in logs %}
<div id="log-{{date|date:'Y-m-d'}}" class="calendar-log-data">
    <h3>{{date}}</h3>

    {% regroup logs|get_item:date by exercise as grouped_logs %}

    {# TODO: what if some of the entries don't belong to a workout? #}
    {% with tmp=grouped_logs|first %}
    {% with first_log=tmp.list|first %}
        <p>
            Go to:
            <a href="{{first_log.workout.get_absolute_url}}">workout</a> |
            <a href="{% url 'workout-log' first_log.workout.id %}">log overview</a>
        </p>
    {% endwith %}
    {% endwith %}
    <ul>
    {% for i in grouped_logs %}
        <li>{{i.grouper}}
        <ul>
        {% for log in i.list %}
            <li>{{log.reps}} Ã— {{log.weight}}</li>
        {% endfor %}
        </ul>
        </li>
    {% endfor %}
    </ul>

</div>
{% endfor %}
{% endblock %}



{% block sidebar %}
    <h3>{% trans 'Info' %}</h3>
    <p>{% blocktrans %}The coloured days in the calendar have weight logs,
you can click on them to see the details. Click on an empty day to
add a log.{% endblocktrans %}</p>

<h3>{% trans 'Log' %}</h3>
<p><a href="{% url 'workout-calendar' %}">{% trans "Go to today" %}</a></p>
<div>
{% for date in month_list %}
    {% ifchanged date.year %}
        <p><strong>{{ date|date:"Y" }}</strong></p>
    {% endifchanged %}
    {% if current_month = date.month and current_year = date.year %}
        {{date|date:"F"}}<br>
    {% else %}
        <a href="{% url 'workout-calendar' date.year date.month %}">{{date|date:"F"}}</a><br>
    {% endif %}
{% endfor %}
</div>

{% endblock %}