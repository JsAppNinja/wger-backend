{% extends "base.html" %}
{% load i18n %}
{% load staticfiles %}
{% load wger_extras %}

{% block header %}
<script>
$(document).ready(function() {

    $("form").click(function(e){
        e.preventDefault();

        // BMR
        var bmr_url = $("#bmr-form").attr('action');
        $.post(bmr_url,
               $("#bmr-form").serialize(),
               function(data) {
                   $('#bmr-result-container').show();
                   $('#bmr-result-value').html(data.bmr);

                   // Activities
                   var activities_url = $("#activities-form").attr('action');
                   $.post(activities_url,
                          $("#activities-form").serialize(),
                          function(data) {
                              $('#activities-result-container').show();
                              $('#activities-result-value').html(data.factor);

                              // Total calories
                              $('#id_calories').val(data.activities);
                       });
            });
    });


});
</script>
{% endblock %}

<!--
        Title
-->
{% block title %}{% trans "Daily calories calculator" %}{% endblock %}


<!--
        Main Content
-->
{% block content %}

<h3>{%trans "1. Basal metabolic rate" %}</h3>
<form action="{% url 'calories-calculate' %}"
      method="post"
      class="ym-form"
      id="bmr-form">
{% csrf_token %}

{% if form.non_field_errors %}
<div class="ym-fbox-text ym-error">
    {% for error in form.non_field_errors %}
        <p class="ym-message">{% trans error %}</p>
    {% endfor %}
</div>
{% endif %}

<table>
    {% for current_field in form %}
        {% if current_field.name in select_lists %}
            {% yaml_form_field current_field "ym-fbox-select" %}
        {% else %}
            {% yaml_form_field current_field %}
        {% endif %}
    {% endfor %}
</table>
</form>

<div id="bmr-result-container" style="display:hidden;">
    <p>
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer et augue sem.
Nullam bibendum tortor a lacus luctus tempor. Suspendisse auctor tristique
metus, non ultricies quam.
</p>
    <p>{% trans 'You basic metabolic rate is: ' %} <strong><span id="bmr-result-value">{{user.userprofile.calculate_basal_metabolic_rate|floatformat:2}}</span></strong></p>
</div>




<h3>{%trans "2. Activities" %}</h3>
<form action="{% url 'calories-calculate-activities' %}"
      method="post"
      class="ym-form"
      id="activities-form">
{% csrf_token %}

{% if form.non_field_errors %}
<div class="ym-fbox-text ym-error">
    {% for error in form_activities.non_field_errors %}
        <p class="ym-message">{% trans error %}</p>
    {% endfor %}
</div>
{% endif %}

<table>
    {% for current_field in form_activities %}
        {% if current_field.name in select_lists_activities %}
            {% yaml_form_field current_field "ym-fbox-select" %}
        {% else %}
            {% yaml_form_field current_field %}
        {% endif %}
    {% endfor %}
</table>
</form>

<div id="activities-result-container" style="display:hidden;">
<p>
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer et augue sem.
Nullam bibendum tortor a lacus luctus tempor. Suspendisse auctor tristique
metus, non ultricies quam.
</p>
    <p>{% trans 'Factor for daily activities: ' %} <strong><span id="activities-result-value">{{user.userprofile.calculate_activities|floatformat:2}}</span></strong></p>
</div>


{% endblock %}


{#                 #}
{#    Side bar     #}
{#                 #}
{% block sidebar %}
<h3>{% trans "Total daily calories" %}</h3>
<form action="{% url 'calories-calculate-activities' %}"
      method="post"
      class="ym-form"
      id="total-calories-form">
<table>
    {% yaml_form_field form_calories.calories %}
    <tr>
        <td colspan="2">
            <input type="submit" value="{% trans 'Calculate daily calories' %}" id="form-save">
        </td>
    </tr>
</table>
</form>

<p>
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer et augue sem.
Nullam bibendum tortor a lacus luctus tempor. Suspendisse auctor tristique
metus, non ultricies quam.
</p>
{% endblock %}
