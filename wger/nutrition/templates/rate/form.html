{% extends "base.html" %}
{% load i18n %}
{% load staticfiles %}
{% load wger_extras %}

{% block header %}
<script>
$(document).ready(function() {

    $("#bmr-form").click(function(e){
        e.preventDefault();
        var url = $("#bmr-form").attr( 'action' );

        $.post(url,
            $("#bmr-form").serialize(),
            function(data) {
                //console.log(data);

                $('#bmr-result-container').show();
                $('#bmr-result-value').html(data.bmr);
        });
    });

    $("#activities-form").click(function(e){
        e.preventDefault();
        var url = $("#activities-form").attr( 'action' );

        $.post(url,
        $("#activities-form").serialize(),
            function(data) {
                //console.log(data);

                var total = parseFloat($('#bmr-result-value').html()) * data.activities;
                $('#activities-result-container').show();
                $('#activities-result-value').html(total);

                //$('.result').html(data);
        });
    });

    $("#total-calories-form").click(function(e){
        e.preventDefault();

        var total = parseInt($('#bmr-result-value').html()) + parseInt($('#activities-result-value').html());
        $('#id_calories').val(total);
    });

 });
</script>
{% endblock %}

<!--
        Title
-->
{% block title %}{% trans "Daily calories calculator" %}{% endblock %}


<!--
        Main Content
-->
{% block content %}

<h3>{%trans "1. Basal metabolic rate" %}</h3>
<form action="{% url 'calories-calculate' %}"
      method="post"
      class="ym-form"
      id="bmr-form">
{% csrf_token %}

{% if form.non_field_errors %}
<div class="ym-fbox-text ym-error">
    {% for error in form.non_field_errors %}
        <p class="ym-message">{% trans error %}</p>
    {% endfor %}
</div>
{% endif %}

<table>
    {% for current_field in form %}
        {% if current_field.name in select_lists %}
            {% yaml_form_field current_field "ym-fbox-select" %}
        {% else %}
            {% yaml_form_field current_field %}
        {% endif %}
    {% endfor %}
    <tr>
        <td colspan="2">
            <input type="submit" value="{% trans 'Calculate' %}" id="form-save">
        </td>
    </tr>
</table>
</form>

<div id="bmr-result-container" style="display:hidden;">
    <p>{% trans 'You basic metabolic rate is: ' %} <span id="bmr-result-value">-/-</span></p>
</div>




<h3>{%trans "2. Activities" %}</h3>
<form action="{% url 'calories-calculate-activities' %}"
      method="post"
      class="ym-form"
      id="activities-form">
{% csrf_token %}

{% if form.non_field_errors %}
<div class="ym-fbox-text ym-error">
    {% for error in form_activities.non_field_errors %}
        <p class="ym-message">{% trans error %}</p>
    {% endfor %}
</div>
{% endif %}

<table>
    {% for current_field in form_activities %}
        {% if current_field.name in select_lists_activities %}
            {% yaml_form_field current_field "ym-fbox-select" %}
        {% else %}
            {% yaml_form_field current_field %}
        {% endif %}
    {% endfor %}
    <tr>
        <td colspan="2">
            <input type="submit" value="{% trans 'Calculate' %}" id="form-save">
        </td>
    </tr>
</table>
</form>

<div id="activities-result-container" style="display:hidden;">
    <p>{% trans 'You basic metabolic rate is: ' %} <span id="activities-result-value">-/-</span></p>
</div>

<h2>{% trans "Daily calories" %}</h2>
<form action="{% url 'calories-calculate-activities' %}"
      method="post"
      class="ym-form"
      id="total-calories-form">
<table>
    {% yaml_form_field form_calories.calories %}
    <tr>
        <td colspan="2">
            <input type="submit" value="{% trans 'Calculate' %}" id="form-save">
        </td>
    </tr>
</table>
</form>



{% endblock %}


<!--
        Side bar
-->
{% block sidebar %}{% if sidebar %}{% include sidebar %}{% endif %}{% endblock %}
